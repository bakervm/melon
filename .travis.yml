# language: rust
# sudo: required
# dist: trusty
#
# addons:
#   apt:
#     packages:
#       - libssl-dev
#
# cache: cargo
#
# rust:
#   - stable
#   - beta
#   - nightly
#
# matrix:
#   allow_failures:
#     - rust: nightly
#
# before_cache: |
#   if [[ "$TRAVIS_RUST_VERSION" == nightly ]]; then
#     RUSTFLAGS="--cfg procmacro2_semver_exempt" cargo install cargo-tarpaulin
#   fi
#
# script:
#   - cargo clean
#   - cargo build
#   - cargo test
#
# after_success: |
#   if [[ "$TRAVIS_RUST_VERSION" == nightly ]]; then
#     cargo tarpaulin --out Xml
#     bash <(curl -s https://codecov.io/bash)
#   fi
#

branches:
  only:
    - master

jobs:
  include:
    - name: "Windows build"
      os: windows
      language: rust
      rust: stable
      script:
        - cargo build --verbose --all
        - cargo test --verbose --all
    - name: "macOS build"
      os: osx
      rust: stable
      script:
        - cargo build --verbose --all
        - cargo test --verbose --all
    - name: "Ubuntu build"
      os: linux
      dist: trusty
      rust: stable
      script:
        - cargo build --verbose --all
        - cargo test --verbose --all
    - name: "Code coverage"
      os: linux
      dist: trusty
      rust: nightly
      install: RUSTFLAGS="--cfg procmacro2_semver_exempt" cargo install cargo-tarpaulin
      script:
        - cargo tarpaulin --out Xml
        - bash <(curl -s https://codecov.io/bash)
